# Author: Alexis Moins
# Creation: 18 juin 2020
# vim: ft=zsh syn=zsh

# Prevent zsh from appending a symbol at the end of each completion item to
# differenciate its type i.e. '/' for directories, '*' for symlinks...
setopt nolisttypes

# Place le curseur √† la fin du mot lors
# d'une compl√©tion accept√©e
setopt alwaystoend

# Automatically insert the first element of the completion menu
setopt menucomplete

# Lance le menu de compl√©tion depuis la position du curseur, m√™me s'il est √† l'int√©rieur d'un mot
setopt completeinword

# Affiche un menu de s√©l√©ction pour choisir avec quoi compl√©ter
zstyle ':completion:*' menu select

# Utilise les couleurs de LS_COLORS pour afficher le menu de s√©l√©ction
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS} 'ma=1;32;40'

# Compl√©tion insensible aux majuscules / minuscules
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|[._-]=* r:|=*' 'l:|=* r:|=*'

# Display command description in grey
zstyle ':completion:*:options' list-colors '=(#b)*(-- *)=0=1;30'

#
zstyle ':completion:*:*:kill' list-colors '=(#b) #([0-9]#)*( *[a-z])*=37=31=1;30'

# Autorise seulement 2 erreurs pour la compl√©tion approximative
zstyle ':completion:*:approximate:*' max-errors 2

# Utilise la completion approximative, une fois que la compl√©tion normale a √©chou√©e
zstyle ':completion:*' completer _extensions _complete _approximate

# Compl√©tion des chemins partiels
zstyle ':completion:*' list-suffixes

#
zstyle ':completion:*' expand prefix suffix

# Utilise le cache pour la compl√©tion
zstyle ':completion:*' use-cache on

# Chemin vers le dossier .compcache
zstyle ':completion:*' cache-path "${ZDOTDIR}/.cache/zcompcache"

autoload -Uz compinit

_dumpfile="${ZDOTDIR}/.cache/zcompdump"
# Initialize the completions system and check for cache once a day
if [[ -n "${_dumpfile}"(#qN.mh+24) ]]; then
    # If .zcompdump is older than 24 hours, check for changes
    echo "üìñ Checking changes in zcompdump..."
    compinit -i -d "${_dumpfile}"
    touch "${_dumpfile}"
else
    echo "Reading zcompdump..."
    compinit -C -d "${_dumpfile}"
fi

unset _dumpfile
